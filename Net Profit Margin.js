// Net Profit Margin ‚Äî —á–∏—Å—Ç–∞—è —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å
// –ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã—Ä—É—á–∫–∏, –æ—Å—Ç–∞—é—â–∏–π—Å—è –ø–æ—Å–ª–µ –≤—ã—á–µ—Ç–∞ –≤—Å–µ—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤, –≤–∫–ª—é—á–∞—è –Ω–∞–ª–æ–≥–∏ –∏ –ø—Ä–æ—Ü–µ–Ω—Ç—ã.
// üü∞> 10%, –≤ –∏–¥–µ–∞–ª–µ > 15%: –≤—ã—Å–æ–∫–∞—è —á–∏—Å—Ç–∞—è –º–∞—Ä–∂–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∏–ª—å–Ω—É—é –ø—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç—å –ø–æ—Å–ª–µ —É—á–µ—Ç–∞ –≤—Å–µ—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤, –≤–∫–ª—é—á–∞—è –ø—Ä–æ—Ü–µ–Ω—Ç—ã –∏ –Ω–∞–ª–æ–≥–∏.

// 09.04.2025

// –ú–∏—Ö–∞–∏–ª –®–∞—Ä–¥–∏–Ω, https://shardin.name/?utm_source=tradingview
//@version=6
indicator("Net Profit Margin: —á–∏—Å—Ç–∞—è —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å", overlay=false)

// –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö NPM
NPM_quarterly = request.financial(syminfo.tickerid, 'NET_MARGIN', 'FQ')
// TTM ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–≤–µ–Ω–∞–¥—Ü–∞—Ç—å –º–µ—Å—è—Ü–µ–≤, FY ‚Äî —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –≥–æ–¥, FQ ‚Äî —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∫–≤–∞—Ä—Ç–∞–ª –∏ FH ‚Äî –ø–æ–ª—É–≥–æ–¥–æ–≤–æ–π

// –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ —Ñ–æ–Ω–∞
bg_color = NPM_quarterly >= 10 ? color.new(color.green, 90) : color.new(color.red, 90)

// –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–æ–Ω–∞
bgcolor(bg_color, title="–§–æ–Ω —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏")

// –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞
plot(NPM_quarterly, 
     title="Net Profit Margin ‚Äî —á–∏—Å—Ç–∞—è —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å", 
     color=color.yellow, 
     linewidth=2, 
     style=plot.style_line)

// –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏ –¥–ª—è —É—Ä–æ–≤–Ω–µ–π
hline(10, "10% —É—Ä–æ–≤–µ–Ω—å", color=color.silver, linestyle=hline.style_dotted)
hline(15, "15% —É—Ä–æ–≤–µ–Ω—å", color=color.silver, linestyle=hline.style_dotted)

// –í—ã–≤–æ–¥ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –¥–∞–Ω–Ω—ã—Ö
plotchar(NPM_quarterly, "NPM", "", location=location.top)